<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
  </head>
  <style type="text/css">
    html {
      height: 100%;
      font-size: 100vw;
    }
    body {
      width: 100%;
      height: 100%;
      margin: 0;
    }
    
    .bg-default {
      position: absolute;
      width: 100%;
      left: 0;
    }

    .img-default {
      z-index: 1100;
      position: absolute;
    }
    
    .img-pos {
      width: 0.1rem;
      /* height: 750px; */
      position: absolute;
      top: 30%;
      left: 0.4rem;
      margin: auto;
      /* transition: all 1s ease-in-out; */
    }
    .img-big {
      width: 0.66rem;
      left: 0.17rem !important;
      /* right: 0 !important; */
      top: 0 !important;
      bottom: 0 !important;
    }

    .zm-big {
      width: 0.66rem;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
      transform: rotateY(180deg);
      transition: transform 1s ease-in-out;
    }
    .zm-small {
      transition: all 1s ease-in-out;
      border: 3px solid #fffa68;
      box-shadow: 2px 0 0 #fffa68;
    }

    .zm-small-jump {
      animation-name: zmJump;
      animation-duration: 0.6s;
      animation-iteration-count: infinite;
      animation-direction: alternate;
      animation-timing-function: ease-in-out;
    }

    @keyframes zmJump {
      0% {width: 0.1rem}
      100% {width: 0.11rem}
    }
    /* Safari 与 Chrome */
    @-webkit-keyframes zmJump {
      0% {width: 0.1rem}
      100% {width: 0.11rem}
    }

    .bm {
      /* transform: rotateY(180deg); */
      transition: all 1s ease-in-out;
      z-index: 1100;
      /* animation-name: showImgBack;
      animation-duration: 1s;
      animation-iteration-count: 1;
      animation-timing-function: ease-in-out; */
    }
    @keyframes showImgBack {
      0% {width: 0.1rem;}
      100% {width: auto;}
    }
    @-webkit-keyframes showImgBack {
      0% {width: 0.1rem;}
      100% {width: auto;}
    }

    button {
      position: absolute;
      left: 600px;
    }

    .eyes-box {
      /* background-image: radial-gradient(rgb(255 0 0 / 0%) 50%, rgb(0 0 0 / 60%) 66%, #050404 80%, #000); */
      background-image: radial-gradient(rgb(255 0 0 / 0%) 50%, rgb(0 0 0) 80%);
      width: 100%;
      position: absolute;
      height: 0;
      z-index: 1000;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      margin: auto;
      overflow: hidden;
      transition: all 1s ease-in-out;
      /* animation-name: wink;
      animation-duration: 2s;
      animation-iteration-count: infinite;
      animation-direction: alternate;
      animation-timing-function: ease-in-out; */
    }
    /* .eyes-box:before {
      content: '';
      background-image: radial-gradient(rgb(255 0 0 / 0%) 50%, rgb(0 0 0) 80%);
      height: 100%;
      z-index: 9999;
      position: absolute;
      width: 100%;
    }
    .eyes-box:after {
      content: '';
      z-index: 190;
      width: 100%;
      height: 100%;
      position: f;
      top: 0;
      left: 0;
      bottom: 0;
      margin: auto;
      background-repeat: no-repeat;
      background-size: 100% 100%;
      background-image: url('http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/74eea566cea2ec3f3750add19392bae7.png');
    } */
    .eyes-border {
      height: 100%;
      border: 1px solid #000;
      box-sizing: border-box;
      width: 100%;
      position: fixed;
      z-index: 111111111;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      margin: auto;
    }
    .eyes {
      background-image: radial-gradient(rgb(255 0 0 / 0%) 50%, rgb(0 0 0) 80%);
      height: 100%;
      z-index: 9999;
      position: absolute;
      width: 100%;
      box-shadow: 0 0 1px #000;
    }

    @keyframes wink {
      0% {height: 20px;}
      /* 20% {top: -20px;}
      45% {top: -2px;} */
      /* 50% {top: 0;} */
      /* 70% {top: -20px;}
      95% {top: -38px;} */
      100% {height: 0.5rem;}
    }
    /* Safari 与 Chrome */
    @-webkit-keyframes wink {
      0% {height: 20px;}
      /* 20% {top: -20px;}
      45% {top: -2px;} */
      /* 50% {top: 0;} */
      /* 70% {top: -20px;}
      95% {top: -38px;} */
      100% {height: 0.5rem;}
    }
    
    .bg {
      top: 0;
      height: 100%;
      background-color: #000;
      z-index: 100;
    }
    .bg-top {
      /* background-image: linear-gradient(#000 626.5px, #ff00 626.5px, #ff00 1116.5px, #000 1116.5px, #000); */
      background-color: #000;
      z-index: 999;
      top: 0;
      transition: all 1s ease-in-out;
      box-shadow: 0 2px 0 #000;
    }
    .bg-bottom {
      background-color: #000;
      z-index: 999;
      bottom: 0;
      transition: all 1s ease-in-out;
      box-shadow: 0 -2px 0 #000;
    }
    /* .bg-map {
      z-index: 990;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      margin: auto;
      transition: height 1s ease-in-out;
      background-image: url(asset/map.jpg);
      overflow: hidden;
    } */
    .bg-map {
      z-index: 1;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      margin: auto;
      /* background-image: url(./asset/map.jpg); */
    }
    /* 开始动画 */
    .leaf {
      width: 100%;
      height: 200px;
      z-index: 200;
      position: absolute;
      animation-name: sway;
      animation-duration: 2s;
      animation-iteration-count: infinite; /* 动画无数次播放*/
      animation-direction: alternate; /* 动画在奇数次（1、3、5...）正向播放，在偶数次（2、4、6...）反向播放 */
      animation-timing-function: ease-out;
    }
    @keyframes sway {
      0% {top: -40px;}
      /* 20% {top: -20px;}
      45% {top: -2px;} */
      /* 50% {top: 0;} */
      /* 70% {top: -20px;}
      95% {top: -38px;} */
      100% {top: 0;}
    }
    /* Safari 与 Chrome */
    @-webkit-keyframes sway {
      0% {top: -40px;}
      /* 20% {top: -20px;}
      45% {top: -2px;} */
      /* 50% {top: 0;} */
      /* 70% {top: -20px;}
      95% {top: -38px;} */
      100% {top: 0;}
    }

    .angel {
      position: absolute;
      z-index: 200;
      width: 150px;
      height: 150px;
      bottom: 200px;
      left: 200px;
      animation-name: flyone,flytow,flydistant;
      animation-duration: 5s;
      animation-iteration-count: infinite;
      animation-delay: 7.4s;
      /* animation-timing-function: ease-in-out; */
    }
    @keyframes flyone {
      0% {left: 200px;}
      /* 20% {top: -20px;}
      45% {top: -2px;} */
      50% {left: 600px;}
      /* 70% {top: -20px;}
      95% {top: -38px;} */
      100% {left: 300px;}
    }
    @keyframes flytow {
      0% {bottom: 200px;}
      /* 20% {top: -20px;}
      45% {top: -2px;} */
      50% {bottom: 450px;}
      /* 70% {top: -20px;}
      95% {top: -38px;} */
      100% {bottom: 600px;}
    }
    @keyframes flydistant {
      0% {width: 150px; height: 150px;}
      100% {width: 70px; height: 70px;}
    }

    .radar-box{
      width: 100%;
      overflow: hidden;
      position: relative;
      z-index: 1100;
      height: 100%;
      /* background: rgb(0 0 0 / 40%); */
      /* display: none; */
    }
    .radar-begin {
      bottom: 30%;
      left: 0;
      right: 0;
      margin: auto;
    }
    /* 雷达 */
    .radar {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      margin: auto;
      width: 100%;
      z-index: 1100;
      transform: rotate(0deg);
      animation-name: radar;
      animation-duration: 3s;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
    }
    @keyframes radar {
      0% {transform: rotate(0deg);}
      /* 20% {top: -20px;}
      45% {top: -2px;} */
      /* 50% {transform: rotate(-180deg);} */
      /* 70% {top: -20px;}
      95% {top: -38px;} */
      100% {transform: rotate(-360deg);}
    }
    /* Safari 与 Chrome */
    @-webkit-keyframes radar {
      0% {transform: rotate(0deg);}
      /* 20% {top: -20px;}
      45% {top: -2px;} */
      /* 50% {transform: rotate(-180deg);} */
      /* 70% {top: -20px;}
      95% {top: -38px;} */
      100% {transform: rotate(-360deg);}
    }

    .pos {
      width: 0.1rem;
      animation-name: jump;
      animation-duration: 3s;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }
    @keyframes jump {
      0% {transform: rotateY(0deg);}
      30% {transform: rotateY(-360deg);}
      100% {transform: rotateY(-360deg);}
    }
    /* Safari 与 Chrome */
    @-webkit-keyframes jump {
      0% {transform: rotateY(0deg);}
      30% {transform: rotateY(-360deg);}
      100% {transform: rotateY(-360deg);}
    }

    .rolling-over {
      left: 0;
      right: 0;
      margin: auto;
    }
    .btn-group {
      display: none;
      justify-content: space-around;
      width: 0.8rem;
      align-items: center;
      margin: auto;
      position: absolute;
      left: 0;
      right: 0;
    }
  </style>
  <body>
    <!-- 开头背景和睁眼效果 -->
    <!-- <div id='bg' class='bg bg-default'></div> -->
    <div id='bgTop' class="bg-top bg-default"></div>
    <div id="eyes" class="eyes-box">
      <!-- <div class="eyes"></div>
      <img src="http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/74eea566cea2ec3f3750add19392bae7.png" class="bg-map" onload="mapOnload()">
      <div class="eyes-border"></div> -->
    </div>
    <div id='bgBottom' class="bg-bottom bg-default"></div>
    <!-- <div id="bg" class="bg bg-default"></div> -->
    <!-- <div id='bgMap' style="z-index: 998;" class="bg-map"></div> -->
    <!-- <img src='http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/6029b490ab0c992e627806af2aae8693.jpg' class="bg-map" onload="mapOnload()"> -->

    <!-- 定位按钮 -->
    <!-- <img src="./asset/pos.png" alt="" class="pos img-default"> -->

    <!-- 开始动画 -->
    <!-- <img src='./asset/839af78322450ea0eb6dbb1d19889d831862804f.png' class="leaf" />
    <img src="./asset/ag.jpg" alt="" class="angel" /> -->
    <!-- <div class="forest"></div> -->

    <!-- 雷达开始按钮 -->
    <!-- <img src="./asset/radarBeginImg.png" class="radar-begin img-default" /> -->

    <!-- 雷达 -->
    <div class="radar-box" id='radarBox'></div>
    <!-- <div class="radar-box" id='radarBox'>
      <img src="./asset/radar.png" alt="" class="radar">
    </div> -->
    
    <div id='btnGroup' class="btn-group img-default"></div>
  </body>
  <script type="text/javascript">
    let z = 10
    const screenW = document.body.offsetWidth
    const screenH = document.body.offsetHeight
    // 用于缓存图片start
    let radarImg = null
    let radarBeginImg = null
    let cardImg1 = null
    let posImg = null
    let rollingOverBtnImg = null
    // 用于缓存图片end
    let imgInDom = { // 记录是否已经将图片添加到html里（单例模式需要）
      radarBegin: false,
      radar: false,
      posImg: false,
      rollingOverBtnImg: false
    }
    // 记录定位点位置
    const cardPos = [
      {
        left: '0.46rem', 
        top: '23%'
      },
      {
        left: '0.1rem',
        top: '46%'
      },
      {
        left: '0.68rem',
        top: '49%'
      },
      {
        left: '0.4rem',
        top: '65%'
      },
      {
        left: '0.60rem',
        top: '80%'
      }
    ]
    // 图片正反面url
    const cardImgUrls = [
      {
        back: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/54be9414b115adb73fef09b0c5ddd603.png',
        frontage: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/c9c66745d54fa8387b3a2716300a8f9f.png'
      },
      {
        back: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/fb1c30f9937df3ad00702cb043417d04.png',
        frontage: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/27a317787633137ce1c1db5da4239811.png'
      },
      {
        back: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/4945471b2bfa5790e8d2aba70c588734.png',
        frontage: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/062aee42738743fbe85fe3d9e9fd63d6.png'
      },
      {
        back: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/9738604d09188d02be091b99732c2d90.png',
        frontage: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/1e4d0136552f45b2888c66ac4468f8e3.png'
      },
      {
        back: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/9cbb7a7f60dbf0f2978167f5d2382d87.png',
        frontage: 'http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/7d1eea50f630fe41d2368d4593d7c477.png'
      }
    ]
    // 图片正反面onload之后的缓存
    const cardImgCatch = [
      {
        back: null,
        frontage: null,
        backInDom: false,
        frontageInDom: false,
        url: 'https://market.m.taobao.com/app/miniapp-biz/qrcode/index.html?_ariver_appid=3000000028379505&nbsv=0.1.2109231403.28&_mp_code=tb&query=clearStorage%3D1%26merchantNum%3D1900110%26platform%3D1%26type%3D0&nbsource=debug&nbsn=DEBUG&transition=present'
      },
      {
        back: null,
        frontage: null,
        backInDom: false,
        frontageInDom: false,
        url: 'https://www.baidu.com'
      },
      {
        back: null,
        frontage: null,
        backInDom: false,
        frontageInDom: false,
        url: 'https://www.bilibili.com/v/dance/?spm_id_from=666.4.b_7072696d6172794368616e6e656c4d656e75.17'
      },
      {
        back: null,
        frontage: null,
        backInDom: false,
        frontageInDom: false,
        url: 'https://www.bilibili.com/anime/?spm_id_from=666.5.b_7072696d6172794368616e6e656c4d656e75.8'
      },
      {
        back: null,
        frontage: null,
        backInDom: false,
        frontageInDom: false,
        url: 'https://www.bilibili.com/'
      }
    ]
    let currentCardPos = {}
    let cardCatchList = []
    let cardCatch = {}
    // 初始化
    function init() {
      let c = localStorage.getItem('cardCatch')
      let id = localStorage.getItem('ticketId')
      if (!c) {
        localStorage.setItem('cardCatch', [])
        cardCatchList = []
      } else {
        cardCatchList = JSON.parse(c)
      }
      if (!id) {
        localStorage.setItem('ticketId', new Date().getTime())
        // 发送UA
      }
    }
    init()
    // 缓存卡牌
    function catchCard(urlObj) {
      cardCatchList.push({
        pos: currentCardPos,
        urls: urlObj
      })
      localStorage.setItem('cardCatch', JSON.stringify(cardCatchList))
    }
    // 卡牌转到正面
    function rollingCard(h, card, urlObj) {
      const zm = card.frontage
      const bm = card.back
      zm.style.transform = 'rotateY(90deg)'
      bm.style.transform = 'rotateY(90deg)'
      catchCard(urlObj)
      setTimeout(() => {
        const btnGroupDom = document.getElementById('btnGroup')
        btnGroupDom.style.top = h + 'px'
        btnGroupDom.style.display = 'flex'
        zm.style.zIndex = 1200
        bm.style.display = 'none'
        zm.style.transform = 'rotateY(0deg)'
        bm.style.transform = 'rotateY(0deg)'
      }, 1000)
    }
    // 卡牌再次变大
    function frontToBig(card, pos) {
      cardCatch = card
      currentCardPos = pos
      card.frontage.style.transitionProperty = 'none'
      cardCatch.frontage.classList.remove('zm-small-jump')
      card.frontage.classList.remove('zm-small')
      // 触发雷达的按钮隐藏
      radarBeginImg.style.display = 'none'
      card.frontage.classList.add('img-big')
      card.frontage.style.width = '0.66rem'
      card.frontage.style.zIndex = 1100
      const btnGroupDom = document.getElementById('btnGroup')
      // btnGroupDom.style.top = (screenH * 0.5 + card.frontage.height * 0.5 + 50) + 'px'
      btnGroupDom.style.display = 'flex'
      window.requestAnimationFrame(function() {
        card.frontage.style.transitionProperty = 'all'
      })
    }
    function summonAgain() {
      // 卡牌正面变换style
      cardCatch.frontage.classList.remove('zm-big')
      cardCatch.frontage.classList.add('zm-small')
      let card = cardCatch
      let pos = currentCardPos
      if (cardCatch.frontage.classList.contains('img-big')) {
        cardCatch.frontage.classList.remove('img-big')
      }
      setTimeout(function() {
        card.frontage.classList.add('zm-small-jump')
      }, 1000)
      cardCatch.frontage.style.width = '0.1rem'
      cardCatch.frontage.style.left = currentCardPos.left
      cardCatch.frontage.style.top = currentCardPos.top
      cardCatch.frontage.style.zIndex = 100
      cardCatch.frontage.onclick = function() {
        frontToBig(card, pos)
      }
      currentCardPos = {}
      cardCatch = {}
      addRadarBeginImg()
      // 卡牌背面隐藏
      // card.back.style.display = 'none'
    }
    // 安装其他按钮
    function loadOtherBtn() {
      const obtainCardBtnImg = loadImgSynchronization('./asset/obtain_card.png')
      const summonAgainBtnImg = loadImgSynchronization('./asset/summon_again.png')
      const btnGroupDom = document.getElementById('btnGroup')
      btnGroupDom.appendChild(obtainCardBtnImg)
      btnGroupDom.appendChild(summonAgainBtnImg)
      obtainCardBtnImg.onclick = function() {
        window.open(cardCatch.url)
        btnGroupDom.style.display = 'none'
        summonAgain()
      }
      summonAgainBtnImg.onclick = function() {
        summonAgain()
        btnGroupDom.style.display = 'none'
      }
    }
    // 卡背变大
    function backToBig(card, urlObj) {
      const dom = card.back
      dom.classList.add('img-big')
      // 添加点击翻转卡牌按钮
      if (!rollingOverBtnImg) {
        rollingOverBtnImg = loadImgSynchronization('./asset/rollingOver.png', ['img-default', 'rolling-over'])
        rollingOverBtnImg.onload = function() {
          loadOtherBtn()
        }
      }
      // 正面添加进html，添加 点击卡牌 按钮
      setTimeout(() => {
        let h = screenH * 0.5 + dom.height * 0.5 + 50
        // 卡牌底部位置 screenH * 0.5 + h * 0.5
        rollingOverBtnImg.style.top = h + 'px'
        if (!imgInDom.rollingOverBtnImg) {
          imgInDom.rollingOverBtnImg = true
          document.body.appendChild(rollingOverBtnImg)
          rollingOverBtnImg.onclick = function() {
            rollingCard(h, card, urlObj) // 卡牌转到正面
            rollingOverBtnImg.style.display = 'none'
            // alert('rolling-over')
          }
        } else {
          rollingOverBtnImg.style.display = 'inherit'
          rollingOverBtnImg.onclick = function() {
            rollingCard(h, card, urlObj) // 卡牌转到正面
            rollingOverBtnImg.style.display = 'none'
            // alert('rolling-over')
          }
        }
        document.body.appendChild(card.frontage)
        card.frontageInDom = true
      }, 1000)
    }
    // 点击选择卡牌
    function randomCard() {
      posImg.style.display = 'none'
      if (cardImgCatch.length === 0) {
        // TODO. 所有卡牌都被抽走的情况
        return
      }
      const index = Math.round(Math.random() * (cardImgCatch.length - 1))
      cardCatch = cardImgCatch.splice(index, 1)[0]
      let urlObj = cardImgUrls.splice(index, 1)[0]
      cardCatch.left = currentCardPos.left
      cardCatch.top = currentCardPos.top
      cardCatch.backInDom = true
      cardCatch.back.style.left = currentCardPos.left
      cardCatch.back.style.top = currentCardPos.top
      // cardCatch.back.setAttribute('key', cardCatch.key)
      document.body.appendChild(cardCatch.back)
      setTimeout(() => {
        backToBig(cardCatch, urlObj)
      }, 100);
    }
    // 添加定位按钮
    function addPosBtn() {
      if (cardPos.length === 0) {
        // TODO. 所有卡牌都被抽走的情况
        return
      } 
      const index = 0
      currentCardPos = cardPos.splice(index, 1)[0]
      if (!imgInDom.posImg) {
        imgInDom.posImg = true
        posImg.onclick = function() {
          randomCard()
        }
        document.body.appendChild(posImg)
      } else {
        posImg.style.display = 'inherit'
      }
      posImg.style.left = currentCardPos.left
      posImg.style.top = currentCardPos.top
    }
    // 判断所有卡背、卡正面加载完成
    function judgeAllImgLoaded() {
      return !cardImgCatch.some(item => !item.backInDom || !item.frontageInDom)
    }
    // 开始雷达转动
    function radarBegin() {
      radarBeginImg.style.display = 'none'
      const radarBoxDom = document.getElementById('radarBox')
      // 添加雷达
      if (!imgInDom.radar) {
        imgInDom.radar = true
        radarBoxDom.style.background = 'rgb(0 0 0 / 40%)'
        radarBoxDom.appendChild(radarImg)
      } else {
        radarBoxDom.style.display = 'inherit'
      }
      setTimeout(function() {
        function radarEnd(){
          radarBoxDom.style.display = 'none'
          addPosBtn()
        }
        // 判断是不是所有卡背都加载完成
        if (judgeAllImgLoaded()) {
          radarEnd()
        } else {
          // 如果图片没有加载完。雷达继续转
          var radarEndInterval = setInterval(() => {
            if (judgeAllImgLoaded()) {
              radarEnd()
              clearInterval(radarEndInterval)
            }
          }, 1000);
        }
      }, 2000)
    }
    // 添加雷达转动开始按钮
    function addRadarBeginImg() {
      if (!imgInDom.radarBegin) {
        imgInDom.radarBegin = true
        radarBeginImg.onclick = radarBegin
        document.body.appendChild(radarBeginImg)
      } else {
        radarBeginImg.style.display = 'inherit'
      }
    }
    
    // 眨眼结束。眼睛睁开
    function openEyes() {
      const eyes = document.getElementById('eyes')
      const bgBottom = document.getElementById('bgBottom')
      const bgTop = document.getElementById('bgTop')
      // eyes.style.transition = 'none'
      eyes.style.transitionDuration = bgBottom.style.transitionDuration = bgTop.style.transitionDuration = '1s'
      eyes.style.opacity = 0 // 眼睛完全睁开
      bgTop.style.opacity = bgBottom.style.opacity = 0
      setTimeout(function() {
        eyes.style.display = 'none'
        bgTop.style.display = bgBottom.style.display = 'none'
      }, 2000)
      // 上下遮挡打开
      // setTimeout(() => {
      //   bgTop.style.height = bgBottom.style.height = 0
      //   bgTop = bgBottom = null
      // }, 1000)
      setTimeout(() => {
        // radarBegin()
        addRadarBeginImg()
      }, 200)
    }
    // 预加载其他所有图片
    function otherImgOnload() {
      cardImgUrls.forEach(function(item, index) {
        // 加载卡背
        loadImg(item.back, ['img-pos', 'bm', 'img-default']).then(function(res) {
          cardImgCatch[index].backInDom = true
          cardImgCatch[index].back = res
        })
        // 加载卡正面
        loadImg(item.frontage, ['img-pos', 'zm-big', 'img-default']).then(function(res) {
          cardImgCatch[index].frontageInDom = true
          cardImgCatch[index].frontage = res
        })
      })
    }
    function posOnload() {
      loadImg('./asset/pos.png', ['pos', 'img-default']).then(function(res) {
        // console.log(res)
        posImg = res
        otherImgOnload()
      })
    }
    // 眨眼
    function mapOnload() {
      // console.log(e)
      loadImg('http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/1bd295afa23047530e62cbb4077aa8e0.png', ['radar']).then(function(res) {
        // console.log(res)
        radarImg = res
        posOnload()
      })
      loadImg('./asset/radarBeginImg.png', ['radar-begin', 'img-default']).then(function(res) {
        // console.log(res)
        radarBeginImg = res
      })
    }
    function wink(eyesH, time = 1, isEnd = false) {
      const eyes = document.getElementById('eyes')
      if (!eyes) {
        alert('eyes dom不存在！')
        window.requestAnimationFrame(function() {
          winkBegin()
        })
        return false
      }
      // const bgMap = document.getElementById('bgMap')
      // bgMap.style.height = eyesH + 'px'
      const bgHeight = screenH / 2 - eyesH / 2 * screenW // 1rem是screenW px。(eyesH / 2 * screenW)将(eyesH / 2)rem转成px
      const bgBottom = document.getElementById('bgBottom')
      const bgTop = document.getElementById('bgTop')
      eyes.style.transitionDuration = bgBottom.style.transitionDuration = bgTop.style.transitionDuration = time + 's'
      
      eyes.style.height = eyesH + 'rem'
      bgBottom.style.height = bgTop.style.height = bgHeight + 'px'
      if (isEnd) {
        setTimeout(function() {
          openEyes()
        }, 1400)
      }
      return true
    }
    function winkBegin() {
      let r = wink(0)
      if (r) {
        setTimeout(function() {
          wink(0.2)
        }, 20)
        let i = 0
        function winkLoop() {
          const winkInterval = setTimeout(function() {
            i++
            let h = 0.05
            let isEnd = false
            if (i & 1) {
              h = 0.05
            } else if (i === 2) {
              // h = screenW / 4
              h = 0.3
              if (radarImg && radarBeginImg) {
                isEnd = true
                // clearInterval(winkInterval)
              }
            } else if (i >= 4) {
              // h = screenW / 3
              h = 0.4
              if (radarImg && radarBeginImg) {
                isEnd = true
                // clearInterval(winkInterval)
              }
            }
            // 开始扫描按钮图片 和雷达图片要在睁眼前加载好
            wink(h, 0.6 + i * 0.2, isEnd)
            if (!isEnd) {
              winkLoop()
            }
          }, 800 + i * 200)
        }
        winkLoop()
      }
    }
    window.onload = function(){
      // setTimeout(function() {
      //   const eyes = document.getElementById('eyes')
      //   eyes.style.animationIterationCount = 0
      // }, 8000)
      winkBegin()
      document.html
      loadImg('http://enbrands-2.oss-cn-shanghai.aliyuncs.com/user/74eea566cea2ec3f3750add19392bae7.png', ['bg-map']).then(function(res) {
        // console.log(res)
        // mapImg = res
        // res.style.height = screenH + 'px'
        // document.getElementById('eyes').appendChild(res)
        document.body.appendChild(res)
        mapOnload()
      })
    }
    
    // 睁眼效果
    // function wink() {
    //   const eyes = document.getElementById('eyes')
    //   // eyes.style.backgroundImage = 
    // }

    // 加载图片（非异步） 
    function loadImgSynchronization(url, classList) {
      let img = document.createElement('img')
      img.src = url
      if (classList && classList.length > 0) {
        classList.forEach(element => {
          img.classList.add(element)
        })
      }
      return img
    }
    // 预加载图片
    function loadImg(url, classList) {
      return new Promise(function(reslove, reject) {
        let img = document.createElement('img')
        img.src = url
        if (classList && classList.length > 0) {
          classList.forEach(element => {
            img.classList.add(element)
          })
        }
        img.onload = function(e) {
          console.log(e)
          reslove(img)
          img.onload = null
        }
      })
    }
  </script>
</html>
